<!DOCTYPE html>
<html>
<head>
    <title>Ceylon Tea Regions - Official Map View</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background-color: #eee;}
        #map { height: 100vh; width: 100%; }
        
        .info-panel {
            position: absolute; top: 20px; right: 20px; z-index: 1000;
            background: white; padding: 20px; border-radius: 12px;
            width: 150px;
        }
        
        h6 { color: #1b5e20; margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .legend-item { display: flex; align-items: center; margin-bottom: 8px; font-size: 10px; }
        .dot { height: 12px; width: 12px; border-radius: 50%; display: inline-block; margin-right: 10px; border: none; }

        .underline { width: 100%; height: 2px; background: #000000; margin-bottom: 10px; margin-top: -10px;}

        /* Style for the custom back button */
        .leaflet-control-back {
            background: white;
            width: 34px;
            height: 34px;
            line-height: 34px;
            text-align: center;
            border-radius: 50%; /* Circle shape */
            box-shadow: 0 1px 5px rgba(0,0,0,0.4);
            cursor: pointer;
            display: block;
            text-decoration: none;
            color: black;
            font-size: 18px;
            font-weight: bold;
            border: 2px solid rgba(0,0,0,0.2);
        }

        .leaflet-control-back:hover {
            background: #f4f4f4;
            color: #1b5e20;
        }
    </style>
</head>
<body>

{% if regions %}

  <div class="info-panel">
      <h4>7 Tea Regions</h4>
      <a href="">Home</a>
      <div class="underline"></div>
      {% for r in regions %}
        <div>
            <h5>{{ r.region }}: <b>{{ r.total }} </b>Samples</h5>
            <div class="legend-item"><span class="dot" style="background: #4caf50;"></span> Accepted: {{ r.accepted }}</div>
            <div class="legend-item"><span class="dot" style="background: #e2700c;"></span> Rejected: {{ r.rejected }}</div>
            <div class="legend-item"><span class="dot" style="background: #81c784;"></span> Average confidence:</b> {{ r.avg_confidence }}</div>
        </div>
      {% endfor %}
  </div>
  
{% else %}
  <p>No prediction data available yet.</p>
{% endif %}


<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // Initialize the map focused on the Hill Country of Sri Lanka
    var map = L.map('map').setView([7.2, 80.7], 8.5);

    // Add a clean, light-colored map layer
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Styling for the Bold Borders
    var regionStyle = {
        color: "#0a3d0d",     // Dark green bold border
        weight: 4,            // BOLD thickness
        opacity: 1,
        fillOpacity: 0.6
    };

    // Data for the 7 Regions (Geographic Coordinates)
    var regions = [
        { name: "Nuwara Eliya", coords: [6.97, 80.78], color: "#2e7d32", desc: "Highest elevation; 'Champagne' of tea." },
        { name: "Dimbula", coords: [6.92, 80.60], color: "#2e7d32", desc: "Misty western slopes; golden tint." },
        { name: "Uva", coords: [6.85, 81.05], color: "#2e7d32", desc: "Exotic aroma; unique seasonal character." },
        { name: "Uda Pussellawa", coords: [7.05, 80.90], color: "#2e7d32", desc: "Pinkish hue; tangy and strong." },
        { name: "Kandy", coords: [7.29, 80.63], color: "#4caf50", desc: "Mid-grown; full-bodied and robust." },
        { name: "Sabaragamuwa", coords: [6.68, 80.40], color: "#81c784", desc: "Low-grown; deep color, sweet flavor." },
        { name: "Ruhuna", coords: [6.15, 80.50], color: "#81c784", desc: "Low-grown; distinctively black leaf." }
    ];

    // Add circles to represent the zones with bold borders
    regions.forEach(function(reg) {
        L.circle(reg.coords, {
            ...regionStyle,
            fillColor: reg.color,
            radius: 12000 // Size of the zone
        }).addTo(map)
          .bindPopup("<b>" + reg.name + "</b><br>" + reg.desc);
    });

    // Define a custom control for the Back Button
var backButton = L.Control.extend({
    options: {
        position: 'topleft' // Places it near the + / - buttons
    },

    onAdd: function (map) {
        var container = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
        var button = L.DomUtil.create('a', 'leaflet-control-back', container);
        
        // Left arrow symbol and hyperlink to your index page
        button.innerHTML = '&#8592;'; 
        button.href = "{{ url_for('index') }}"; // Change this to your actual index filename
        button.title = 'Back to Home';

        return container;
    }
});

// Add the button to the map
map.addControl(new backButton());
</script>

</body>
</html>